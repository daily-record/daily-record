## 6.1 有限自动机的等价性



#### DFA与NFA的等价性证明思路

二者差别：

|            | NFA               | DFA  |
| ---------- | ----------------- | ---- |
| 初始状态   | 不唯一            | 唯一 |
| 弧上的标记 | 字（单字字符、ε） | 字符 |
| 转换关系   | 非确定            | 确定 |

**如果能够消除二者在初始状态，在弧上的标记以及在转换关系上这三方面的差别，就能够把NFA变换成DFA**



#### DFA与NFA的等价性证明

假定NFA M=<S,Σ,δ, S~0~, F>，我们对M的状 态转换图进行以下改造：



##### 解决初始状态唯一性

- 引进新的初态结点X和终态结点Y，X,Y ∉S，从X到S~0~中任意状态结点连一条ε箭弧， 从F中任意状态结点连一条 ε箭弧到Y

![image-20200307183141018](F:\learning\note\编译原理\第六讲.assets\image-20200307183141018.png)



##### 简化弧上的标记

- 对M的状态转换图进一步施行替换，其中k是新引入的状态

![image-20200307183303977](F:\learning\note\编译原理\第六讲.assets\image-20200307183303977.png)

- 逐步把图转变为每条弧只标记为 Σ上的一个字符或 ε，最后得到一个NFA M’，显然 L(M’)=L(M)

![image-20200307183610945](F:\learning\note\编译原理\第六讲.assets\image-20200307183610945.png)



##### 解决ε弧和转换关系

**NFA确定化--子集法**



###### 解决ε弧

设I是的状态集的一个子集，定义I的 ε-闭包 `ε-closure(I)`为:

- 若s ∈I，则`s∈ε-closure(I)`；
- 若s ∈I，则从s出发经过**任意**条ε弧而能到达的任何状态s’都属于 `ε-closure(I)`

即
$$
ε-closure(I)=I ∪\{s’|从某个s ∈I出发经过任意条 ε 弧能到达s’\}
$$


设a是 Σ中的一个字符，定义
$$
I_a = ε-closure(J)
$$
其中，J为I中的某个状态出发经过一条a弧而到达的状态集合

![image-20200307210803068](F:\learning\note\编译原理\第六讲.assets\image-20200307210803068.png)



例：

![image-20200307215358059](F:\learning\note\编译原理\第六讲.assets\image-20200307215358059.png)



###### 确定化

不失一般性，设字母表只包含两个a 和 b，构造一张计算状态集的转换表：

1. 首先，置第 1行第 1列为 ε - closure({X})求出这一列的I~a~，I~b~
2. 检查这两个I~a~，I~b~，看它们是否已在表中的第一列中出现，把未曾出现的填入后面的空行的第 1列上，求出每行第 2， 3列上的集合...
3. 重复上述过程，直到所有第 2，3列子集全部出现在第一列为止

![image-20200307232209075](F:\learning\note\编译原理\第六讲.assets\image-20200307232209075.png)



##### 状态转换关系表推算样例

![image-20200307233656083](F:\learning\note\编译原理\第六讲.assets\image-20200307233656083.png)

- 把表看成状态转换矩阵，子集视为状态
- 转换表唯一刻划了一个确定 的有限自动机M
    - `初态` 是 ε-closure({X})
    - `终态`是含有原终态Y的子集
- 对于每个NFA M存在一个 DFA M ’ ，使得 L(M)=L(M’)

最终结果：

![image-20200307234407769](F:\learning\note\编译原理\第六讲.assets\image-20200307234407769.png)





#### DFA的化简

> 对于给定的DFA M，寻找一个状态数比M少的DFA M’，使得L(M)=L(M’)

- 状态的等价性
    - 假设s和t为M的两个状态，称s和t**等价**：如果从状态 s出发能读出某个字 α而停止于**终态**，那么同样，从t 出发也能读出 α而停止于**终态**；反之亦然（s和t到达的终态可以不一样但必须得是终态）
    - 两个状态不等价，则称它们是可区别的

两个状态s和t是可区分的，是指：

**`存在`一个字 α，要么s读出 α停止于终态而t读出 α停止于非终态，要么t读出 α停止于终态而s读 出 α停止于非终态**



##### 化简的基本思想

- 把M的状态集划分为一些不相交的子集，使得任何两个不同子集的状态是可区别的，而同一子集的任何两个状态是等价的
- 最后，让每个子集选出一个代表，同时消去其他状态



**按照上述原则对DFA的状态集合S进行第一次划分，正确的分法是：`终态和非终态`**

> 可区别：存在一个字 α，要么 s读出 α停止于终态而 t读出 α 停 止于非终态，要么 t读出 α停止于终态而 s读出 α停止于非终态

**归根结底，需要找到一个字，把状态集区分开来，而 `ε` 可以把终态与非终态区分开来（终态经过ε依然在终态，而非终态经过ε依然处于非终态）**





#### DFA化简算法

 ![image-20200308155035199](F:\learning\note\编译原理\第六讲.assets\image-20200308155035199.png)







## 6.2 正规式与有限自动机的等价性



#### 正规式与有限自动机的等价性

- 一个正规式r与一个有限自动机M等价
    - L(r)=L(M)
- FA ->正规式
    - 对任何FA M，都存在一个正规式r，使得L(r)=L(M)
- 正规式 -> FA
    - 对任何正规式r，都存在一个FA M，使得L(M)=L(r)





#### 为NFA构造正规式

假定NFA M=<S,Σ,δ, S~0~, F>，我们对M的状态转换图进行以下改造：

- 在M的转换图上加进两个状态X和Y，从X用 ε弧连接到M的所有初态结点，从M的所有终态结点用 ε弧连接到Y
- 然后，反复使用下面的三条规则，逐步消去结点， 直到只剩下X和Y为止

![image-20200308171844080](F:\learning\note\编译原理\第六讲.assets\image-20200308171844080.png)

![image-20200308205920564](F:\learning\note\编译原理\第六讲.assets\image-20200308205920564.png)



- **对任何FA M，都存在一个正规式r，使得L(r)=L(M)**

    



#### 为正规式构造NFA

对给定正规式r中的运算符数目进行归纳（归纳法）：

- 验证r中的运算符数目为0时，结论成立
- 假设结论对于运算符数目少于k(k ≥1)的正规式成立
- 基于该假设，证明结论对于运算符数目为k的正规式成立



1. 若r具有零个运算符，则r= ε 或r= φ 或r=a，其中 a∈Σ，针对上述3类正规式r，分别按照下图构造NFA M，M只有一个初态和一个终态，而且没有从终态出发的箭弧，而且使L(M)和对应的L(r)相等

![image-20200308214257087](F:\learning\note\编译原理\第六讲.assets\image-20200308214257087.png)



2. 假设对于运算符数目少于k(k ≥1) 的正规式成立

![image-20200308234846121](F:\learning\note\编译原理\第六讲.assets\image-20200308234846121.png)

![image-20200308234856521](F:\learning\note\编译原理\第六讲.assets\image-20200308234856521.png)

![image-20200308234907737](F:\learning\note\编译原理\第六讲.assets\image-20200308234907737.png)



#### 由正规式构造DFA示例

![image-20200309000326351](F:\learning\note\编译原理\第六讲.assets\image-20200309000326351.png)





## 6.3 词法分析程序自动生成

#### 词法分析器的自动产生--LEX

![image-20200309002138905](F:\learning\note\编译原理\第六讲.assets\image-20200309002138905.png)



![image-20200309003237097](F:\learning\note\编译原理\第六讲.assets\image-20200309003237097.png)





![image-20200309003514036](F:\learning\note\编译原理\第六讲.assets\image-20200309003514036.png)

- `辅助定义`：以文法形式，给一些常用的正规式进行命名

- `识别规则`：多条词法分析规则，每一个规则都要返回单词对应的种类编码及对应的值



##### LEX工作过程

![image-20200309004110313](F:\learning\note\编译原理\第六讲.assets\image-20200309004110313.png)